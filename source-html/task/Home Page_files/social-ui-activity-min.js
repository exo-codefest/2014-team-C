define("SHARED/social-ui-activity",["SHARED/socialUtil","SHARED/jquery","SHARED/mentionsPlugin","SHARED/mentionsLib"],function(i,f,j,h){eXo.define.names=["socialUtil","$","mentionsPlugin","mentions"];eXo.define.deps=[i,f,j,h];return function(c,f){var a={COMMENT_BLOCK_BOUND_CLASS_NAME:"commentBox commentBlockBound ",COMMENT_BLOCK_BOUND_NONE_CLASS_NAME:" commentBox commentBlockBoundNone",DEFAULT_COMMENT_TEXT_AREA_HEIGHT:"28px",FOCUS_COMMENT_TEXT_AREA_HEIGHT:"28px",FOCUS_COMMENT_TEXT_AREA_COLOR:"#999999",
DEFAULT_COMMENT_TEXT_AREA_COLOR:"#808080",isLoadLike:!1,onLoad:function(b){a.configure(b);a.init()},configure:function(b){a.activityId=b.activityId||null;a.inputWriteAComment=b.inputWriteAComment||"";a.commentMinCharactersAllowed=b.commentMinCharactersAllowed||0;a.commentMaxCharactersAllowed=b.commentMaxCharactersAllowed||0;a.commentFormDisplayed="true"==b.commentFormDisplayed?!0:!1;a.allCommentsDisplayed=b.allCommentsDisplayed=!0;a.commentFormFocused=b.commentFormFocused=!0;if(null==a.activityId)alert("err: activityId is null!");
else if(a.commentLinkId="CommentLink"+a.activityId,a.commentFormBlockId="CommentFormBlock"+a.activityId,a.commentTextareId="CommentTextarea"+a.activityId,a.commentButtonId="CommentButton"+a.activityId,a.deleteCommentButtonIds=[],a.contentBoxId="ContextBox"+a.activityId,a.deleteActivityButtonId="DeleteActivityButton"+a.activityId,a.allCommentSize=parseInt(b.allCommentSize),a.commentBlockBoundId="CommentBlockBound"+a.activityId,a.commentBlockIds=[],a.activityContextBoxId="ActivityContextBox"+a.activityId,
0<a.allCommentSize)for(b=1;b<=a.allCommentSize;b++)a.deleteCommentButtonIds[b-1]="DeleteCommentButton"+a.activityId+b,a.commentBlockIds[b-1]="CommentBlock"+a.activityId+b},init:function(){a.commentLinkEl=c("#"+a.commentLinkId);a.commentFormBlockEl=c("#"+a.commentFormBlockId);a.commentTextareaEl=c("#"+a.commentTextareId);a.commentButtonEl=c("#"+a.commentButtonId).show();a.deleteCommentButtonEls=[];a.contentBoxEl=c(a.contentBoxId);a.deleteActivityButtonEl=c("#"+a.deleteActivityButtonId);a.commentBlockBoundEl=
c("#"+a.commentBlockBoundId);a.inputContainer=c("#InputContainer"+a.activityId);a.commentBlockEls=[];a.activityContextBoxEl=c("#"+a.activityContextBoxId);if(0<a.allCommentSize)for(var b=0;b<a.allCommentSize;b++)a.deleteCommentButtonEls[b]=c("#"+a.deleteCommentButtonIds[b]),a.commentBlockEls[b]=c("#"+a.commentBlockIds[b]);(!a.commentFormBlockEl||!a.commentTextareaEl||!a.commentButtonEl)&&alert("err: init UIActivity!");b=c("#"+a.commentLinkId);if(0<b.length)b.off("click").on("click",function(){var a=
c(this).attr("id").replace("CommentLink","");c("#InputContainer"+a).fadeToggle("fast",function(){var a=c(this);if("block"===a.css("display")){var b=a.parents(".uiActivityStream:first").find(".inputContainerShow");0<b.length&&b.removeClass("inputContainerShow").hide();a.addClass("inputContainerShow");a.find("div.replaceTextArea:first").focus();b=(c(window).height()-a.height())/2;a=a.offset().top-b-20;a=0<a?a:0;c("html, body").animate({scrollTop:a},"slow")}else a.removeClass("inputContainerShow")})});
c("textarea#CommentTextarea"+a.activityId).exoMentions({onDataRequest:function(a,b,g){c.getJSON(window.location.protocol+"//"+window.location.host+"/"+eXo.social.portal.rest+"/social/people/getprofile/data.json?search="+b,function(a){a=f.filter(a,function(a){return-1<a.name.toLowerCase().indexOf(b.toLowerCase())});g.call(this,a)})},idAction:"CommentButton"+a.activityId,elasticStyle:{maxHeight:"52px",minHeight:"22px",marginButton:"4px",enableMargin:!1},messages:window.eXo.social.I18n.mentions});b=
c("a.controllDelete");if(0<b.length)b.off("click").on("click",function(){c(".currentDeleteActivity:first").removeClass("currentDeleteActivity");var b=c(this);b.addClass("currentDeleteActivity");var e=b.attr("id");if(null==e||0==e.length)c("#SocialCurrentConfirm").removeAttr("id"),e="SocialCurrentConfirm",b.attr("id",e);b=b.attr("data-confirm");eXo.social.PopupConfirmation.confirm(e,[{action:a.removeActivity,label:"OK"}],"Confirmation",b,"Close")})},loadLikes:function(a){a=c(a).find(".listLikedBox:first");
0<a.length&&(a.find(".listLiked:first").find("a").show(),a.find(".listLiked:first").find("button.btn").hide(),a.attr("data-load","false"))},displayLikes:function(){if(!0!==a.isLoadLike){var b=c("div#UIActivitiesLoader").find(".activityStream");c.each(b,function(b,c){a.displayLike(c)});var d=setTimeout(function(){a.isLoadLike=!1;clearTimeout(d)},400)}},displayLike:function(b){a.isLoadLike=!0;b=c(b).find(".listLikedBox:first");if(0<b.length&&"false"!==b.attr("data-load")){var d=b.find(".listLiked:first"),
b=d.find("button.btn").hide(),e=d.width(),d=d.find("a");d.show();var g=d.length;if(0<g)for(var f=e=1*Math.floor(e/(d.eq(0).outerWidth()+12));f<g;++f)d.eq(f).hide(),f===g-1&&(b.show(),d.eq(e-1).hide())}},loadLikes:function(){var b=c("#"+a.contentBoxId);c(b).find(".listLiked").find("a").show();a.isLoadLike=!0},removeActivity:function(){var a=c(".currentDeleteActivity:first"),d=a.attr("id");a.removeClass("currentDeleteActivity");0<d.indexOf("Activity")?(d=d.replace("DeleteActivityButton",""),c("#activityContainer"+
d).css("overflow","hidden").animate({height:"1px",opacity:"0"},500,function(){c(this).removeClass("activityStream");window.eval(a.attr("data-delete").replace("javascript:",""))})):0<d.indexOf("Comment")&&(d=d.replace("DeleteCommentButton",""),c("#commentContainer"+d).css("overflow","hidden").animate({height:"1px",opacity:"0.1"},300,function(){c(this).hide();window.eval(a.attr("data-delete").replace("javascript:",""))}))},hightlightComment:function(a){var d=0<window.location.href.indexOf("comment=1"),
e=window.location.hash.match("#comment-([\\w|/]+|)");null!=e&&(e=e[1],c("#commentContainer"+e).css("background-color","#f0f0f0"),d?this.replyByURL(a):(a=document.getElementById("commentContainer"+e))&&a.scrollIntoView(!0))},replyByURL:function(a){c(document).ready(function(){var d=c("#CommentLink"+a);0<d.length&&d.trigger("click")})},setPageTitle:function(a){c(document).attr("title","Activity: "+c("<div></div>").html(window.decodeURIComponent(a)).text())},loadLikersByURL:function(){c(document).ready(function(){var b=
c("#"+a.contentBoxId);c(b).find(".listLiked").find(".btn").trigger("click")})}};return a}(f,h._)});