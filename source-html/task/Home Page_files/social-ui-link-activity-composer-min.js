define("SHARED/social-ui-link-activity-composer",["SHARED/socialUtil","SHARED/jquery"],function(i,h){eXo.define.names=["socialUtil","$"];eXo.define.deps=[i,h];return function(a){var f={HTTP:"http://",GRAY_COLOR:"gray",BLACK_COLOR:"black",SINGLE_COMMA:"single_comma",DOUBLE_COMMA:"double_comma",ENTER_KEY_CODE:13,changeLinkContent:function(){var a=this.linkData.link||"",g=this.linkData.title;image=this.linkData.image;description=this.linkData.description;a="link="+a+"&title="+g+"&description="+description;
null!=image&&(a+="&image="+encodeURIComponent(image));g=this.changeLinkContentUrl.replace(/&amp;/g,"&")+"&ajaxRequest=true";ajaxRequest("POST",g,!0,a)},addEditableText:function(d,g,c){var d=a(d),b=d.html().trim(),c=a("<"+g+" />").attr("title",c).val(b);"input"===g?(c.attr("type","text"),c.attr("size",50),c.attr("class","InputTitle"),c.attr("className","InputTitle")):"textarea"===g&&(c.attr("cols",50),c.attr("rows",5),c.attr("class","InputDescription"),c.attr("className","InputDescription"));c.insertAfter(d);
d.hide();c.focus();c.keypress(function(b){13==(b.which?b.which:b.keyCode)&&e(this)});c.blur(function(){e(this)});var e=function(b){var d=a(b).prev();d.text(a(b).val()).html();d.css("display","block");if(d.hasClass("title"))f.linkData.title=a(b).val(),f.changeLinkContent.apply(f);else if(d.hasClass("content"))f.linkData.description=a(b).val(),f.changeLinkContent.apply(f);a(b).remove()}},onLoad:function(a){f.configure(a);f.init()},configure:function(a){this.titleEditable=a.titleEditable||"";this.linkInfoDisplayed=
a.linkInfoDisplayed||!1;this.inputLinkId=a.inputLinkId||"inputLink";this.attachButtonId=a.attachButtonId||"attachButton";this.attachUrl=encodeURI(decodeURIComponent(a.attachUrl||""));this.changeLinkContentUrl=encodeURI(decodeURIComponent(a.changeLinkContentUrl||""));this.shownThumbnailIndex=a.shownThumbnailIndex||0;this.uiThumbnailDisplayId=a.uiThumbnailDisplayId||"UIThumbnailDisplay";this.thumbnailsId=a.thumbnailsId||"Thumbnails";this.backThumbnailId=a.backThumbnailId||"BackThumbnail";this.nextThumbnailId=
a.nextThumbnailId||"NextThumbnail";this.statsId=a.statsId||"Stats";this.thumbnailCheckboxId=a.thumbnailCheckboxId||"ThumbnailCheckbox";this.linkData=a.linkData||{};this.attachUrl||alert("error: attachUrl is null!")},resetIsReady:function(){},init:function(){function d(){for(var b=0,c=this.images.length;b<c;b++)a(this.images[b]).css({display:"none",height:"100px",width:"100px",padding:"10px"});a(this.images[this.shownThumbnailIndex]).css({display:"block",height:"100px",width:"100px",padding:"10px"});
g.apply(this)}function g(){this.stats.html(this.shownThumbnailIndex+1+" / "+this.images.length)}b=this;if(this.linkInfoDisplayed){this.uiThumbnailDisplay=a("#"+this.uiThumbnailDisplayId);this.thumbnails=a("#"+this.thumbnailsId);this.backThumbnail=a("#"+this.backThumbnailId);this.nextThumbnail=a("#"+this.nextThumbnailId);this.stats=a("#"+this.statsId);this.linkTitle=a("#LinkTitle");this.linkDescription=a("#LinkDescription");var c=this.titleEditable;if(this.linkTitle)this.linkTitle.on("dblclick",function(){b.addEditableText(this,
"input",c)});if(this.linkDescription)this.linkDescription.on("dblclick",function(){b.addEditableText(this,"textarea",c)});this.thumbnails?(this.thumbnailCheckbox=a("#"+this.thumbnailCheckboxId),this.images=a("img",this.thumbnails),g.apply(this),d.apply(b),this.backThumbnail.on("click",function(){if(0<b.shownThumbnailIndex)b.shownThumbnailIndex--,d.apply(b),b.linkData.image=a(b.images[b.shownThumbnailIndex]).attr("src"),b.changeLinkContent.apply(b)}),this.nextThumbnail.on("click",function(){if(b.shownThumbnailIndex<
b.images.length-1)b.shownThumbnailIndex++,d.apply(b),b.linkData.image=a(b.images[b.shownThumbnailIndex]).attr("src"),b.changeLinkContent.apply(b)}),this.thumbnailCheckbox.on("click",function(){"checked"==b.thumbnailCheckbox.attr("checked")?(b.linkData.image="",a("#UIRightBox").removeClass("contentRight"),a("#UIRightBox").addClass("resetMargin")):(b.linkData.image=a(b.images[b.shownThumbnailIndex]).attr("src"),a("#UIRightBox").removeClass("resetMargin"),a("#UIRightBox").addClass("contentRight"));a("#UIThumbnailLeftBox").toggle();
b.changeLinkContent.apply(b)})):this.images=[]}else{this.inputLink=a("#"+this.inputLinkId);this.attachButton=a("#"+this.attachButtonId);this.inputLink.val(b.HTTP);this.inputLink.css("color",b.GRAY_COLOR);var b=this,e=this.inputLink,f=this.attachButton;e.on("focus",function(){e.val()===b.HTTP&&(e.val(""),e.css("color",b.BLACK_COLOR))});this.inputLink.on("blur",function(){""===e.val()&&(e.val(b.HTTP),e.css("color",b.GRAY_COLOR))});this.inputLink.on("keypress",function(c){b.ENTER_KEY_CODE==(c.which?
c.which:c.keyCode)&&a(f).click()});this.attachButton.removeAttr("disabled");this.attachButton.on("click",function(){if(!(""===e.val()||e.val()===b.HTTP)){var c=encodeURIComponent(encodeURI(e.val())),c=b.attachUrl.replace(/&amp;/g,"&")+"&objectId="+c+"&ajaxRequest=true";ajaxGet(c,function(){try{a("textarea#composerInput").exoMentions("showButton",function(){})}catch(b){}})}})}var h=a("#UIActivityComposerContainer").find("a.uiIconClose:first");if(0<h.length)h.on("click",function(){a("textarea#composerInput").exoMentions("clearLink",
function(){})})}};return f}(h)});