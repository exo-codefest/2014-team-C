define("SHARED/quick-edit",["SHARED/jquery"],function(o){eXo.define.names=["gj"];eXo.define.deps=[o];return function(c){function n(){}var b={init:function(){var a=window.location;this.hostName=a.href.substring(0,a.href.indexOf(a.pathname));this.xmlHttpRequest=!1;this.command="/contents/editing";this.defaultMethod="POST";this.languageLoaded=!1;this.EmptyTitleErrorMsg=this.InternalServerErrorMsg="";this.isModified=!1;this.publishLink=this.draft=this.editorName=""}};b.loadLanguage=function(a){if(!b.languageLoaded)with(b)a[0]&&
(InternalServerErrorMsg=decodeURI(a[0])),a[1]&&(EmptyTitleErrorMsg=decodeURI(a[1]))};b.removeHoverClass=function(){c(".containerHoverClass").removeClass("containerHoverClass");c(".containerHoverClassInner").removeClass("containerHoverClassInner")};b.modifyInlineContent=function(){b.init();b.isModified=!0};b.saveInlineContent=function(a){if(b.isModified){var d=a.container;b.editorName=a.name;var f=d.getAttribute("repo"),h=d.getAttribute("workspace"),e=d.getAttribute("uuid"),g=d.getAttribute("sitename"),
k=d.getAttribute("language"),j=d.getAttribute("propertyname");b.draft=d.getAttribute("draftmsg");b.publishLink=d.getAttribute("fastpublishlink");var i="",i=0<=j.indexOf("exo:title")?a.editable().getText():a.getData(),a="",a="newValue="+encodeURIComponent(i);c(d.$).append("<i class='uiWaitting'></i>");d=c(d.$).parent();i=d.offset();c(d).append("<div class='markLayerInline' style='width:"+c(d).outerWidth()+"px; height:"+c(d).outerHeight()+"px; top:"+i.top+"px; left:"+i.left+"px'></div>");b.presentationRequestChangePropertyPOST("/property?",
j,f,h,e,g,k,a);b.isModified=!1}return!1};b.onEnterRequest=function(){if(window.event&&13==window.event.keyCode)return!1};b.presentationSwitchBlock=function(a,b){var f=document.getElementById(a),c=document.getElementById(b);if(null!=f&&null!=c)f.style.display="none",c.style.display="block"};b.presentationRequestChangeTitle=function(a,d,f,c,e,g,k,j,i,m){var l="",l="",l=m?CKEDITOR.instances[d].getData():document.getElementById(d).value,a=document.getElementById(a).innerHTML;if(null==l||0==l.length)return alert(b.EmptyTitleErrorMsg),
!1;if(l==a)return b.presentationSwitchBlock(g,k),!1;l="newValue="+encodeURIComponent(l);b.presentationRequestChangePropertyPOST("/title?",null,f,c,e,j,i,l);return!1};b.presentationRequestChangeSummary=function(a,d,f,c,e,g,k,j,i,m){a=a="";a=m?CKEDITOR.instances[d].getData():document.getElementById(d).value;a="newValue="+encodeURIComponent(a);b.presentationRequestChangePropertyPOST("/summary?",null,f,c,e,j,i,a);return!1};b.presentationRequestChangeText=function(a,d,f,c,e,g,k,j,i,m){a=a="";a=m?CKEDITOR.instances[d].getData():
document.getElementById(d).value;a="newValue="+encodeURIComponent(a);b.presentationRequestChangePropertyPOST("/text?",null,f,c,e,j,i,a);return!1};b.presentationRequestChangeProperty=function(a,d,c,h,e,g,k,j,i,m,l,n){c=c="";c=n?CKEDITOR.instances[h].getData():document.getElementById(h).value;c="newValue="+encodeURIComponent(c);b.presentationRequestChangePropertyPOST(a,d,e,g,k,m,l,c);return!1};b.presentationRequestChangePropertyPOST=function(a,d,c,h,e,g,k,j){a=b.hostName+eXo.env.portal.context+"/"+
eXo.env.portal.rest+b.command+a;a=a+"repositoryName="+c+"&workspaceName="+h+"&nodeUIID="+e+"&siteName="+g+"&language="+k;null!=d&&(a=a+"&propertyName="+encodeURIComponent(d));b.presentationAjaxRequest(a,j,"POST")};b.presentationAjaxRequest=function(a,d,c){if(window.XMLHttpRequest&&!window.ActiveXObject)try{b.xmlHttpRequest=new XMLHttpRequest}catch(h){b.xmlHttpRequest=!1}else if(window.ActiveXObject)try{b.xmlHttpRequest=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{b.xmlHttpRequest=new ActiveXObject("Microsoft.XMLHTTP")}catch(g){b.xmlHttpRequest=
!1}}if(b.xmlHttpRequest){try{b.xmlHttpRequest.status=200}catch(k){}b.xmlHttpRequest.onreadystatechange=b.presentationAjaxResponse;c?(b.xmlHttpRequest.open(c,a,!0),b.xmlHttpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded")):b.xmlHttpRequest.open(b.defaultMethod,a,!0);d?b.xmlHttpRequest.send(d):b.xmlHttpRequest.send()}};b.presentationAjaxResponse=function(){var a=b.xmlHttpRequest.responseXML;if(a)if(a=a.getElementsByTagName("bundle")[0].getAttribute("message"),4==b.xmlHttpRequest.readyState){if(200==
b.xmlHttpRequest.status)if("OK"==a){c(".uiWaitting").remove();c(".markLayerInline").remove();a=CKEDITOR.instances[b.editorName];a.updateElement();for(var d=a.container.$,d=c(d).parent().get(0),a=null;!a&&d;)(a=c(d).find(".edittingToolBarContainer, .edittingContent").get(0))||(d=c(d).parent().get(0));if(a){var d=c(a).find(".edittingCurrentState").get(0),f=c(d).find("span").get(0);c(f).remove();c(d).append('<span class="draftText">'+b.draft+"</span>");a=c(a).find(".btn-group").get(0);3>c(a).find("a").size()&&
(a=c(a).find("a").get(0),c(a).before('<a class="btn" href="'+b.publishLink+'" rel="tooltip" data-placement="bottom" data-original-title="Publish">            <i class="uiIconEcmsPublish"></i>          </a>'))}c(document).ready(function(){c("*[rel='tooltip']").tooltip()})}else alert(a)}else try{200!=b.xmlHttpRequest.status&&alert(b.InternalServerErrorMsg+"\n"+b.xmlHttpRequest.statusText)}catch(h){}};b.init();window.InlineEditor=b;n.prototype.removeQuickeditingBlock=function(a,b){var c=document.getElementById(a).parentNode,
h=document.getElementById(b);null!=h&&c.removeChild(h)};n.prototype.insertQuickeditingBlock=function(a,b){var f=document.getElementById(a),h=f.parentNode;if(c(h).children("div:first")[0].id==b){var e=document.getElementById(b);e.parentNode.removeChild(e)}e=document.getElementById(b);if(null!=e){if("ie"==eXo.core.Browser.browserType){var g=eXo.env.portal.portalName;if("classic"!=g){if(a==g+"-signin")e.style.left=f.offsetWidth+e.offsetWidth+"px"}else if(a==g+"-logo"||a==g+"-signin")e.style.left=f.offsetWidth+
e.offsetWidth+"px"}h.insertBefore(e,f)}};eXo.ecm.QuickEdit=new n;return{InlineEditor:b,QuickEdit:eXo.ecm.QuickEdit}}(o)});