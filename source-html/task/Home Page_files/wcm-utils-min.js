define("SHARED/wcm-utils",["SHARED/jquery","SHARED/base","SHARED/bts_popover"],function(j,l,n){eXo.define.names=["gj","base","bts_popover"];eXo.define.deps=[j,l,n];return function(d,m){function e(){this.cmdEcmBundle="/bundle/";this.cmdGetBundle="getBundle?";this.cmdSocialPeople="/social/people/";this.cmdGetPeople="getPeopleInfo/";this.showRightContent=!0}function j(){}function l(){}e.prototype.getHostName=function(){var a;if(self==top)a=window.parent.location,a=a.href.substring(0,a.href.indexOf(a.pathname));
else{a=eXo.core.Browser.ie?window.frameElement.src:window.src;var c=document.createElement("a");c.href=a;a=c.protocol+"//"+c.hostname+":"+c.port}return a};e.prototype.request=function(a){var c=!1;if(window.XMLHttpRequest)return c=new window.XMLHttpRequest,c.open("GET",a,!1),c.send(""),c.responseXML;return ActiveXObject("Microsoft.XMLDOM")?(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.load(urlRequestXML),c):null};e.prototype.getCurrentNodes=function(a,c){var b=[],d=[],d=c.split("/"),f;for(f in a)for(var g in a[f].nodes)if(a[f].nodes[g].name==
d[0]){b[0]=a[f].nodes[g];break}f=b[0];for(g=1;g<d.length&&!("null"==f.children);g++)for(var e in f.children){var k=f.children[e];if(d[g]==k.name){f=b[g]=k;break}}return b};e.prototype.getRestContext=function(){return eXo.env.portal.context+"/"+eXo.env.portal.rest};e.prototype.openPrintPreview=function(a){return-1==a.indexOf("?")?a+"?isPrint=true":a+"&isPrint=true"};e.prototype.showInContextHelp=function(a,c){var b=document.getElementById(a),h=document.getElementById(a+"ID"),b=d(b).find("div.InContextHelpContent:first")[0],
f=1;if(b)if("true"==c){b.style.display="block";var f=d(b).find("div.InContextHelpPopup:first")[0],f=d(f).find("div.LeftInContextHelpPopup:first")[0],g=(""+f.innerHTML).length;100>g?(f.style.width=20+4*g+"px",b.style.width=4*g+56+"px",f=4*g+56):(f.style.width="400px",b.style.width="436px",f=436);b.style.left="-"+f+"px";h.className="LeftInContextHelpPopup";f=0;g=b;do f+=g.offsetLeft,g=g.offsetParent;while(g);if(0>f)b.style.left="12px",h.className="RightInContextHelpPopup"}else b.style.display="none"};
e.prototype.showHideComponent=function(a){var c=d(a).parents(".showHideContainer:first")[0],c=d(c).find("div.showHideComponent:first")[0];"none"==c.style.display?(a.childNodes[0].style.display="none",a.childNodes[1].style.display="block",c.style.display="block",eXo.ecm.WCMUtils.setScrollBar()):(a.childNodes[0].style.display="block",a.childNodes[1].style.display="none",c.style.display="none")};e.prototype.showHideSideBar=function(){var a=document.getElementById("LeftContainer"),c=document.getElementById("RightContainer"),
b=document.getElementById("ResizeSideBar"),h=document.getElementById("UISEOPopupWindow"),f=d(h).find("div.FormContainer:first")[0],g=null,g=this.showRightContent?d(b).find("div.ShowRightContent:first")[0]:d(b).find("div.ResizeButton:first")[0];"none"==c.style.display?(c.style.display="block",g.className="ResizeSideBar ShowRightContent",h.style.width="640px",this.showRightContent=!0,a.style.marginRight="244px",f.style.width="610px",h.style.left=h.offsetLeft-240+"px"):(c.style.display="none",h.style.width=
"400px",g.className="ResizeButton",this.showRightContent=!1,a.style.marginRight="none",f.style.width="370px",h.style.left=h.offsetLeft+240+"px")};e.prototype.setScrollBar=function(){try{var a=document.getElementById("UIWorkingArea"),c=document.getElementById("TabContainerParent");if(null!=c){var b=d(c).find("div.UITabContent");if(null!=b)for(i=0;i<b.length;i++){var h=b[i];if("none"!=h.style.display&&430<h.offsetHeight)h.style.height=a.offsetHeight-50+"px",h.style.overflow="auto"}}}catch(f){}};e.prototype.hideContextMenu=
function(a){d(a).parents(".uiRightClickPopupMenu:first")[0].style.display="none"};e.prototype.setHeightRightContainer=function(){var a=document.getElementById("LeftContainer"),c=document.getElementById("RightContainer");if(455<d(a).height())c.style.height=d(a).height()+"px";a=document.getElementById("UISEOPopupWindow");d(a).find("div.formContainer:first");c.style.display="block";a.style.width="640px"};e.prototype.showSEOLanguage=function(a){var c=document.getElementById("addNewSEO"),b=document.getElementById("selectSEOLanguage");
a?(c.style.display="none",b.style.display="block"):(c.style.display="block",b.style.display="none")};e.prototype.addParamIntoAjaxEventRequest=function(a,c){return a.substring(0,a.length-2)+c+"')"};e.prototype.searchNodeTypeOnKeyPress=function(){var a=document.getElementById("NodeTypeText");if(null==a)return!1;a.onkeypress=function(a){var b=!1;if(window.event)b=window.event.keyCode,a=window.event;else if(a.which)b=a.which;if(0==b)b=a.keyCode;if(13==b)return a=d(this).parents(".uiSearchInput:first")[0],
a=d(a).find("a")[0],eval(a.getAttribute("href")),!1}};e.prototype.addEvent=function(a,c,b){a=document.getElementById("object"!=typeof a?a:a.id);if((-1!=c.toLowerCase().indexOf("focus")||-1!=c.toLowerCase().indexOf("blur"))&&void 0==a.tabIndex)a.tabIndex="0";0<=navigator.userAgent.indexOf("MSIE")?a.attachEvent("on"+c,b):a.addEventListener(c,b,!1)};e.prototype.changeStyleClass=function(a,c){var b=!1;try{if(CKEDITOR)for(name in CKEDITOR.instances)CKEDITOR.instances[name].focusManager.hasFocus&&(b=!0)}catch(d){}if(!b)document.getElementById("object"!=
typeof a?a:a.id).className=c};e.prototype.replaceToIframe=function(a){if(document.getElementById(a)){var a=document.getElementById(a),c=document.createElement("IFRAME");with(c)className="ECMIframe",src="javascript:void(0)",frameBorder=0,scrolling="auto";var b=a.value;a.parentNode.replaceChild(c,a);try{var d=c.contentWindow.document;d.open();d.write(b);d.close()}catch(f){}}};e.prototype.setZIndex=function(a){eXo.webui.UIPopup.zIndex=a};e.prototype.getBundle=function(a,c){var b=this.cmdEcmBundle+this.cmdGetBundle+
"key="+a+"&locale="+c,b=this.request(eXo.ecm.WCMUtils.getRestContext()+b),d;try{return d=b.getElementsByTagName(a)[0],d.getAttribute("value")}catch(f){return""}};e.prototype.initSearch=function(a,c,b){a=document.getElementById(a);a=d(a).find("input")[0];d(a).attr("autocomplete","off");d(a).attr("title",b);d(a).val(b);eXo.ecm.WCMUtils.decorateInput(a,b,!0)};e.prototype.decorateInput=function(a,c,b){d(a).val()==c&&b&&d(a).css("color","#9A9A9A");a.form.onsubmit=function(){return!1};d(a).focus(function(){d(this).val()==
c&&b&&d(this).val("");d(this).css("color","black")});d(a).blur(function(){""==d(this).val()&&(d(this).val(c),d(this).css("color","#9A9A9A"))})};e.prototype.loadAvartar=function(a,c){var b=this.cmdSocialPeople+this.cmdGetPeople+a+".json",b=eXo.ecm.WCMUtils.getRestContext()+b;d.ajax({type:"GET",url:b}).complete(function(a){4===a.readyState&&(a=d.parseJSON(a.responseText),d(c).attr("src",a.avatarURL))})};e.prototype.onLoadComments=function(){var a=d("#UIDocumentWorkspace").find("div.comments:first")[0];
d(a).find("a.avatarMedium").each(function(){var a=d(this).attr("commentor"),b=d(this).find("img:first")[0];eXo.ecm.WCMUtils.loadAvartar(a,b)})};e.prototype.loadImageForFileActivityCallback=function(a){d(a).nextAll("a:first")[0].style.display="block";a.style.display="none";d(a.parentNode).removeClass();d(a.parentNode).addClass("fileTypeContent")};e.prototype.getPlacement=function(a){var a=d(a).offset(),c=d(document).outerHeight(),b=d(document).outerWidth(),c=0.5*c-a.top,a=0.5*b-a.left;return Math.abs(a)>
Math.abs(c)?0<a?"right":"left":0<c?"bottom":"top"};e.prototype.pingUserStatus=function(){var a=d("#user-status"),c=15;void 0!=a.html()&&(c=d(a).attr("user-status-ping-frequency"),d(a).attr("user-status-offline-delay"));var b=window.clearInterval(b);setInterval(d.proxy(eXo.ecm.WCMUtils.sendPing,eXo.ecm.WCMUtils),1E3*c);eXo.ecm.WCMUtils.sendPing()};e.prototype.sendPing=function(){d.ajax({url:"/rest/state/ping/",dataType:"json",context:this,success:function(){},error:function(){}})};e.prototype.showPopover=
function(a){d(a).popover({template:'<div class="popover"><div class="arrow"></div><div class="inner"><h3 class="popover-title" style="display:none;"></h3><div class="popover-content"><p></p></div></div></div>'});d(a).popover("show")};e.prototype.hidePopover=function(a){d(a).popover("hide")};eXo.ecm.WCMUtils=new e;j.prototype.cleanName=function(a,c){nameField=document.getElementById(c);if(!nameField.readOnly){var b=ajaxAsyncGetRequest(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/l11n/cleanName?name="+
a,!1);nameField.value=b}};eXo.ecm.SELocalization=new j;l.prototype.insertCSS=function(a,c){function b(){var b=d.value;if(b){var c=CKEDITOR.instances[a].document.$,g=c.getElementsByTagName("head")[0],e=c.getElementById(f);e&&g.removeChild(e);e=c.createElement("style");e.setAttribute("type","text/css");e.setAttribute("id",f);eXo.core.Browser.isIE6()||eXo.core.Browser.isIE7()?e.styleSheet.cssText=b:e.innerHTML=b;g.appendChild(e)}}if(a){var d=document.getElementById(c),f=c+"_Inline",g=1;d.onblur=b;(function k(){if(5>=
g)try{if(b(),b.time)clearTimeout(b.time),b.time=null}catch(a){g++,b.time=setTimeout(k,500)}})()}};eXo.ecm.CKEditor=new l;window.wcm=function(){};wcm.insertCSSFromTextArea2FCK=function(a,c){function b(){var b=d.value;if(b){var c=FCKeditorAPI.Instances[a].EditorWindow.document,g=c.getElementsByTagName("head")[0],e=c.getElementById(f);e&&g.removeChild(e);e=c.createElement("style");e.setAttribute("type","text/css");e.setAttribute("id",f);eXo.core.Browser.isFF()?e.innerHTML=b:e.styleSheet.cssText=b;g.appendChild(e)}}
if(a){var d=document.getElementById(c),f=c+"_Inline",g=1;d.onblur=b;(function k(){if(5>=g)try{if(b(),b.time)clearTimeout(b.time),b.time=null}catch(a){g++,b.time=setTimeout(k,500)}})()}};Utils=function(){Utils.prototype.removeQuickeditingBlock=function(a,c){var b=document.getElementById(a).parentNode,d=document.getElementById(c);null!=d&&b.removeChild(d)};Utils.prototype.insertQuickeditingBlock=function(a,c){var b=document.getElementById(a),e=b.parentNode;if(d(e).children("div")[0].id==c){var f=document.getElementById(c);
f.parentNode.removeChild(f)}f=document.getElementById(c);if(null!=f){if("ie"==eXo.core.Browser.browserType){var g=eXo.env.portal.portalName;if("classic"!=g){if(a==g+"-signin")f.style.left=b.offsetWidth+f.offsetWidth+"px"}else if(a==g+"-logo"||a==g+"-signin")f.style.left=b.offsetWidth+f.offsetWidth+"px"}e.insertBefore(f,b)}}};eXo.wcm=new Utils;eXo.core.Browser.addOnLoadCallback("keepKeywordOnBoxSearch",function(){var a=document.getElementById("siteSearchBox"),a=d(a).find("input.keyword:first")[0],
c=location.search.substring(1);if(c.match(/^portal=[\w%]+&keyword=[\w%]+/)){var b=c.split("&")[0],c=decodeURI(c.substring((b+"keyword=").length+1));if(void 0!=c&&0!=c.length)a.value=unescape(c)}});window.showPopupMenu=function(a){var c=document.getElementById("UIPresentationContainer"),b=document.getElementById("navigation-generator"),e=d(b).find("div.UIWCMNavigationPortlet:first")[0],b=d(a).parents(".UITab:first")[0],f=d(a).nextAll("div:first")[0],g=a.getAttribute("exo:getNodeURL");if(g&&!f){g=ajaxAsyncGetRequest(g,
!1);try{var j=d.parseJSON(g);if(isNaN(j.length))return;var k=document.createElement("div");k.innerHTML=generateContainer(j);b.appendChild(d(k).children("div.ECMMenuItemContainer:first")[0])}catch(l){return}}a.Timeout&&clearTimeout(a.Timeout);if(f&&"block"!=f.style.display)b.style.position="relative",f.style.top=a.offsetHeight+"px",f.style.display="block",f.onmouseout=function(){if("ie"==m.Browser.browserType){if(c)c.style.position="relative";if(e)e.style.position="relative"}a.Timeout=setTimeout(function(){f.style.display=
"none";f.onmouseover=null;f.onmouseout=null},10)},f.onmouseover=function(){if("ie"==m.Browser.browserType){if(c)c.style.position="static";if(e)e.style.position="static"}a.Timeout&&clearTimeout(a.Timeout);a.Timeout=null},a.onmouseout=f.onmouseout};window.showPopupSubMenu=function(a){var c=a,b=!1;(c=d(a).parents(".ArrowIcon:first")[0])&&(b=d(c).nextAll("div:first")[0]);var e=a.getAttribute("exo:getNodeURL");if(e&&!b){e=ajaxAsyncGetRequest(e,!1);try{var f=d.parseJSON(e);if(isNaN(f.length))return;var g=
document.createElement("div");g.innerHTML=generateContainer(f);d(c).parents(".MenuItem:first")[0].appendChild(d(g).children("div.ECMMenuItemContainer:first")[0])}catch(j){return}}(c=d(a).parents(".ArrowIcon:first")[0])&&(b=d(c).nextAll("div:first")[0]);a.Timeout&&clearTimeout(a.Timeout);if(b&&"block"!=b.style.display)b.style.display="block",c.className="",b.onmouseover=function(){c.className="";c.Timeout&&clearTimeout(c.Timeout);c.Timeout=null},b.onmouseout=function(){c.Timeout=setTimeout(function(){var a=
d(b).find("div.ECMMenuItemContainer:first")[0];a?"block"==a.style.display?(a.style.display="none",a.onmouseover=null,a.onmouseout=null):(b.style.display="none",c.className="ArrowIcon",b.onmouseover=null,b.onmouseout=null):(b.style.display="none",c.className="ArrowIcon",b.onmouseover=null,b.onmouseout=null)},10)},a.onmouseout=b.onmouseout,b.style.width=b.offsetWidth+"px",b.style.left=c.offsetLeft+c.offsetWidth+"px",b.style.top=m.Browser.findPosYInContainer(c,b.offsetParent)+"px"};return{WCMUtils:eXo.ecm.WCMUtils,
CKEditor:eXo.ecm.CKEditor,SELocalization:eXo.ecm.SELocalization}}(j,l)});