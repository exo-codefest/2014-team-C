define("SHARED/navigation",["SHARED/base","SHARED/uiPopup","SHARED/portalRequest","SHARED/jquery"],function(l,m,o,n){eXo.define.names=["base","uiPopup","portalRequest","$"];eXo.define.deps=[l,m,o,n];return function(f,j,l){var g={elementsToHide:[],currentVisibleContainers:[],init:function(a,b){this.superClass=l;this.superClass.init(a,b.id)},setPosition:function(a,b,c,d){this.superClass.setPosition(a,b,c,d)},setSize:function(a,b,c){this.superClass.setSize(popupMenu,b,c)},pushVisibleContainer:function(a){g.currentVisibleContainers.push(a)},
popVisibleContainer:function(){g.currentVisibleContainers.pop()},pushHiddenContainer:function(a){g.elementsToHide.push(a)},setCloseTimeout:function(a){a||(a=100);setTimeout(g.doOnMenuItemOut,a)},createLink:function(a,b){if(b&&b.href)a.onclick=function(a){"http://"==b.href.substr(0,7)?window.location.href=b.href:eval(b.href);if(!a)a=window.event;a.stopPropagation&&a.stopPropagation();a.cancelBubble=!0;return!1}},doOnMenuItemOut:function(){for(;0<g.elementsToHide.length;){var a=document.getElementById(g.elementsToHide.shift());
a&&-1===f.inArray(a.id,g.currentVisibleContainers)&&g.hide(a)}},showMenuItemContainer:function(a,b,c){this.superClass.setPosition(a,b,c)},hide:function(a){"string"==typeof a&&(a=document.getElementById(a));a.style.display="none";a.style.visibility="hidden"},show:function(a){this.superClass.show(a);a.style.visibility=""}},e=function(a){"string"==typeof a&&(a=document.getElementById(a));this.mainContainer=a;this.elements=[];this.firstVisibleIndex=0;this.lastVisibleIndex=-1;this.axis=0;this.arrowsContainer=
this.rightArrow=this.leftArrow=this.callback=this.currDirection=null;var b=this;this.refresh=setTimeout(function(){b.checkResize()},700)};e.prototype.init=function(){this.firstVisibleIndex=this.maxSpace=0;this.lastVisibleIndex=-1;if(!this.arrowsContainer){var a=f(this.mainContainer).find(".ScrollButtons");if(a.length)this.arrowsContainer=a[0],a=a.find("a"),2==a.length&&(this.initArrowButton(a[0],"left","ScrollLeftButton","HighlightScrollLeftButton","DisableScrollLeftButton"),this.initArrowButton(a[1],
"right","ScrollRightButton","HighlightScrollRightButton","DisableScrollRightButton"))}if(this.arrowsContainer)this.arrowsContainer.style.display="none",this.arrowsContainer.space=null};e.prototype.loadElements=function(a,b){b&&this.cleanElements();this.elements=f(this.mainContainer).find("."+a)};e.prototype.initArrowButton=function(a,b,c,d,i){if(a)if(a=f(a),a[0].direction=b,a[0].overClass=d,a[0].disabledClass=i,a[0].styleClass=c,a[0].scrollMgr=this,a.on("mouseover",this.mouseOverArrow),a.on("mouseout",
this.mouseOutArrow),a.on("click",this.scroll),"left"==b)this.leftArrow=a[0];else if("right"==b)this.rightArrow=a[0]};e.prototype.enableArrow=function(a,b){if(a&&!b)a.className=a.disabledClass;else if(a&&b)a.className=a.styleClass};e.prototype.mouseOverArrow=function(){if(this.className==this.styleClass)this.className=this.overClass};e.prototype.mouseOutArrow=function(){if(this.className==this.overClass)this.className=this.styleClass};e.prototype.checkAvailableSpace=function(){if(!this.maxSpace)this.maxSpace=
f(this.mainContainer).width()-this.getElementSpace(this.arrowsContainer);var a=0,b=this.elements.length;if(this.currDirection)for(c=this.lastVisibleIndex;0<=c;c--)a+=this.getElementSpace(this.elements[c]),a<this.maxSpace?(this.elements[c].isVisible=!0,this.firstVisibleIndex=c):this.elements[c].isVisible=!1;else for(var c=this.firstVisibleIndex;c<b;c++)a+=this.getElementSpace(this.elements[c]),a<this.maxSpace?(this.elements[c].isVisible=!0,this.lastVisibleIndex=c):this.elements[c].isVisible=!1};e.prototype.getElementSpace=
function(a){if(a&&a.space)return a.space;var b=0;if(a)0==this.axis?(b+=f(a).outerWidth(!0),a.decorator&&(b+=this.getElementSpace(a.decorator))):1==this.axis&&(b+=f(a).outerHeigth(!0),a.decorator&&(b+=this.getElementSpace(a.decorator))),a.space=b;return b};e.prototype.cleanElements=function(){for(var a=0;a<this.elements.length;a++)if(this.elements[a].space=null,this.elements[a].decorator)this.elements[a].decorator.space=null};e.prototype.scroll=function(){this.className!==this.disableClass&&("left"==
this.direction?this.scrollMgr.scrollLeft():"right"==this.direction&&this.scrollMgr.scrollRight());return!1};e.prototype.scrollLeft=function(){if(0<this.firstVisibleIndex)this.currDirection=0,this.firstVisibleIndex--,this.renderElements()};e.prototype.scrollUp=function(){this.scrollMgr&&this.scrollMgr.scrollLeft()};e.prototype.scrollRight=function(){if(this.lastVisibleIndex<this.elements.length-1)this.currDirection=1,this.lastVisibleIndex++,this.renderElements()};e.prototype.scrollDown=function(){this.scrollMgr&&
this.scrollMgr.scrollRight()};e.prototype.renderElements=function(){this.checkAvailableSpace();for(var a=0;a<this.elements.length;a++)this.elements[a].isVisible?this.elements[a].style.display="block":(this.elements[a].style.display="none",this.arrowsContainer.style.display="block");"block"==this.arrowsContainer.style.display&&this.renderArrows();"function"==typeof this.callback&&this.callback()};e.prototype.renderArrows=function(){0==this.firstVisibleIndex?this.enableArrow(this.leftArrow,!1):this.enableArrow(this.leftArrow,
!0);this.lastVisibleIndex==this.elements.length-1?this.enableArrow(this.rightArrow,!1):this.enableArrow(this.rightArrow,!0)};e.prototype.getElementsSpace=function(a,b){null==a&&null==b&&(a=0,b=this.elements.length-1);var c=0;if(0<=a&&b<=this.elements.length-1)for(var d=a;d<=b;d++)c+=this.getElementSpace(this.elements[d]);return c};e.prototype.checkResize=function(){if(this.mainContainer){var a=f("#"+this.mainContainer.id);if(!a.length){clearTimeout(this.refresh);return}this.mainContainer=a[0];this.mainContainer.space=
null;this.arrowsContainer.space=null;var b=f(this.mainContainer).width()-this.getElementSpace(this.arrowsContainer);if(this.maxSpace&&this.maxSpace!==b&&(a=a.closest(".UIWindow"),0==a.length||"block"==a.css("display")))this.init(),this.renderElements()}var c=this;this.refresh=setTimeout(function(){c.checkResize()},700)};var h={hideMenuTimeoutIds:{},scrollMgr:null,init:function(a,b){this.superClass=g;this.superClass.init(a,b);a.onmousedown=null;this.containerStyleClass="MenuItemContainer";this.tabStyleClass=
"MenuItem";this.buildMenu(a)},onLoad:function(a){var b=f("#"+a);b.hasClass("UIHorizontalTabs")&&h.init(b[0],b[0]);"UIHorizontalNavigation"===a&&f(".UIHorizontalNavigation").slice(1).each(function(){f(this).hide()})},buildMenu:function(a){var b=h,a=f(a);a.children(".UITab").each(function(){var a=f(this);a.mouseenter(function(){b.mouseEnterTab(f(this),"UITab HighlightNavigationTab")});var d=a.attr("class");a.mouseleave(function(){b.mouseLeaveTab(f(this),d)});a.find("."+b.containerStyleClass).first().css("minWidth",
a.width())});a.find("."+this.containerStyleClass).each(function(){if(!this.id)this.id=eXo.generateId("PortalNavigationContainer");this.resized=!1;var a=f(this);if(0==a.find("."+b.tabStyleClass).length)a.remove();else a.on({mouseenter:b.onMenuItemOver,mouseleave:b.onMenuItemOut,click:function(d){var i=f(d.target),e=i.attr("href");!e||-1!==e.indexOf("#")&&!i.attr("onclick")?d.stopPropagation():b.hideMenu(a.attr("id"))}},"."+b.tabStyleClass)})},mouseEnterTab:function(a,b){var c=h,d=a.attr("exo:getNodeURL"),
i=a.find("."+c.containerStyleClass).first();if(d&&!i.length){d=ajaxAsyncGetRequest(d,!1);try{var e=f.parseJSON(d)}catch(g){}if(!e||!e.length)return;a.append(c.generateContainer(e))}a.attr("class",b);i=a.find("."+c.containerStyleClass).first();i.length&&(c.cancelHideMenuContainer(i.attr("id")),c.showMenu(a,i));return!1},mouseLeaveTab:function(a,b){var c=h;a.attr("class",b);var d=a.find("."+c.containerStyleClass);d.length&&(c.hideMenuTimeoutIds[d[0].id]=window.setTimeout(function(){c.hideMenu(d[0].id)},
0));return!1},showMenu:function(a,b){var c=h,d=j.Browser;c.superClass.pushVisibleContainer(b.attr("id"));b.css({display:"block",position:"absolute"});var e=b.offsetParent(),g=a.height()+d.findPosYInContainer(a[0],e[0]),k=d.findPosXInContainer(a[0],e[0])+2;j.I18n.isRT()&&(k=d.findPosXInContainer(a[0],e[0],!0));c.superClass.setPosition(b[0],k,g,j.I18n.isRT());c.superClass.show(b[0]);b.css("width",b.width()+"px");c=b.offset().left;j.I18n.isLT()?c+b.width()>=f(window).width()&&(k+=a.width()-b.width(),
b.css("left",k+"px")):c+a.width()<b.width()&&(k+=a.width()-b.width(),b.css("right",k+"px"))},cancelHideMenuContainer:function(a){var b=h.hideMenuTimeoutIds[a];h.hideMenuTimeoutIds[a]=null;b&&window.clearTimeout(b)},hideMenu:function(a){var b=h;b.hideMenuTimeoutIds[a]=null;a=f("#"+a);if(a.length){var c=a.attr("id");b.superClass.pushHiddenContainer(c);b.superClass.popVisibleContainer(c);b.superClass.setCloseTimeout();b.superClass.hide(a[0])}},onMenuItemOver:function(){var a=f(this),b=h,c=a.attr("exo:getNodeURL"),
d=a.find("."+b.containerStyleClass).first();if(c&&!d.length){c=ajaxAsyncGetRequest(c,!1);try{var e=f.parseJSON(c)}catch(g){}if(!e||!e.length){a.removeClass("ArrowIcon");a.removeAttr("exo:getNodeURL");return}a.append(b.generateContainer(e))}d=a.find("."+b.containerStyleClass).first();d.length&&(b.superClass.pushVisibleContainer(d.attr("id")),b.showMenuItemContainer(a,d),d.data("firstTime")||(d.css("width",d.width()+2+"px"),d.data("firstTime",!0)))},showMenuItemContainer:function(a,b){var c=a.width(),
d=a.position().top;this.superClass.show(b[0]);var e=f(window).width()-j.Browser.findPosX(a[0],!0),e=j.I18n.isLT()?j.Browser.findPosX(a[0]):e;c+b.width()+e>f(window).width()&&(c-=b.width()+a.width());this.superClass.setPosition(b[0],c,d,j.I18n.isRT())},onMenuItemOut:function(){var a=f(this),b=h,a=a.find("."+b.containerStyleClass).first();a.length&&(a=a.attr("id"),b.superClass.pushHiddenContainer(a),a=f.inArray(a,b.superClass.currentVisibleContainers),-1!==a&&b.superClass.currentVisibleContainers.splice(a,
1),b.superClass.setCloseTimeout(200))},loadScroll:function(a){var b=h,a=f("#"+a);if(a.length)b.scrollMgr=new e(a[0]),b.scrollMgr.loadElements("UITab"),b.scrollMgr.init(),b.scrollMgr.renderElements()},generateContainer:function(a){for(var b="<ul class='"+this.containerStyleClass+"' style='display: none;' id='",b=b+(eXo.generateId("PortalNavigationContainer")+"' resized='false'>"),c=0;c<a.length;c++){var d=a[c],e=d.actionLink?d.actionLink:"#"+d.label,b=b+("<li class='MenuItem "+(d.hasChild?"ArrowIcon ":
"")+(d.isSelected?"SelectedItem'":"NormalItem'")),b=b+(d.hasChild?" exo:getNodeURL='"+d.getNodeURL+"' ":""),b=b+("' title='"+d.label+"'>"),b=b+("<a class='ItemIcon "+(d.icon?d.icon:"DefaultPageIcon")+"'href='"+e+"'>"+(40<d.label.length?d.label.substring(0,37)+"...":d.label)+"</a>");d.childs.length&&(b+=h.generateContainer(d.childs));b+="</li>"}return b+"</ul>"}};return{ScrollManager:e,UIPopupMenu:g,UIPortalNavigation:h}}(n,l,m)});